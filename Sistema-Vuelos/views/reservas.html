<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../public/css/style.css" />
  <script type="module" src="../controllers/reservas.js"></script>
  <script type="module" src="../controllers/vuelos.js"></script>
  <title>Gestionar Reservas</title>
</head>
<body>
  <nav>
    <ul>
      <li><a href="index.html">Inicio</a></li>
    </ul>
  </nav>

  <h1>Gestionar Reservas</h1>

  <!-- Formulario para agregar una reserva -->
  <form id="formReserva">
    <label for="vueloId">ID de Vuelo:</label>
    <input type="text" id="vueloId" required />
    <label for="pasajero">Nombre del Pasajero:</label>
    <input type="text" id="pasajero" required />
    <button type="submit">Agregar Reserva</button>
  </form>

  <button id="mostrarReservas">Mostrar Reservas</button>
  <button id="verVuelosDisponibles" onclick="mostrarVuelos()">Ver Vuelos Disponibles</button>
  <div id="vuelosDisponibles" class="oculto">
    <!-- Aquí se mostrará la tabla de vuelos -->
  </div>

  <div id="resultado"></div>

  <!-- Formulario para realizar check-in por ID de reserva -->
  <h2>Realizar Check-in</h2>
  <form id="formCheckIn">
    <label for="reservaId">ID de Reserva para Check-in:</label>
    <input type="text" id="reservaId" required />
    <button type="submit">Realizar Check-in</button>
  </form>

  <script type="module">
    import { agregarReserva, mostrarReservas, realizarCheckIn } from "../controllers/reservas.js";
    import { obtenerVuelosDisponibles } from "../controllers/vuelos.js";

    // Manejo del evento de envío del formulario de reserva
    document.getElementById("formReserva").addEventListener("submit", (event) => {
      event.preventDefault();
      const vueloId = document.getElementById("vueloId").value;
      const pasajero = document.getElementById("pasajero").value;
      agregarReserva(vueloId, pasajero);
      document.getElementById("formReserva").reset();
    });

    // Manejo del botón para mostrar reservas
    document.getElementById("mostrarReservas").addEventListener("click", () => {
      const reservas = mostrarReservas();
      const resultadoDiv = document.getElementById("resultado");

      resultadoDiv.innerHTML = reservas.length
        ? reservas.map(r => `<p>Reserva ID: ${r.id}, Vuelo ID: ${r.vueloId}, Pasajero: ${r.pasajero}, Check-in: ${r.checkedIn ? 'Realizado' : 'Pendiente'}</p>`).join("")
        : "No hay reservas disponibles.";
    });

    // Función para mostrar vuelos disponibles en tabla
    window.mostrarVuelos = () => {
      const vuelos = obtenerVuelosDisponibles();
      const vuelosDiv = document.getElementById("vuelosDisponibles");
      vuelosDiv.classList.toggle("oculto");

      if (!vuelosDiv.classList.contains("oculto")) {
        vuelosDiv.innerHTML = `<table>
          <tr><th>ID</th><th>Destino</th><th>Fecha</th><th>Capacidad</th></tr>
          ${vuelos.map(v => `<tr><td>${v.id}</td><td>${v.destino}</td><td>${v.fecha}</td><td>${v.capacidad}</td></tr>`).join("")}
        </table>`;
      }
    };

    // Manejo del evento de envío del formulario de check-in
    document.getElementById("formCheckIn").addEventListener("submit", (event) => {
      event.preventDefault();
      const reservaId = document.getElementById("reservaId").value;
      realizarCheckIn(reservaId);
      document.getElementById("formCheckIn").reset();
    });
  </script>

  <footer>
    <p>&copy; 2024 Sistema de Gestión de Vuelos. Todos los derechos reservados.</p>
    <p><a href="#">Política de privacidad</a> | <a href="#">Términos y condiciones</a></p>
    <p>Contáctanos: <a href="mailto:info@gestionvuelos.com">info@gestionvuelos.com</a></p>
  </footer>
</body>
</html>
